<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket System - QueueWorks</title>
    <link rel="icon" type="image/x-icon" href="/Media/head.svg">
    <link rel="stylesheet" href="style.css">
    <link rel="javascript" href="/Backend/main.js">
</head>
    <main>
        <div class="container">
            <div class="card">
                <div class="navbar">
                    <div class="navbar-buttons">
                        <a href="index.html" class="nav-link">Home</a>
                        <a href="live.html" class="nav-link">Live</a>
                        <a href="login.html" class="nav-link">Login</a>
                    </div>
                </div>
            <img src="/Media/logo.svg" alt="logo" class="logo">
            <select name="lehrjahr" id="lehrjahr" class="input-field">
                <option value="" disabled selected>Lehrjahr</option>
                <option value="Basis">Basis</option>
                <option value="Praxis">Praxis</option>

            </select>
            <button id="apply-filter" class="input-field">Apply filter</button>
            <div id="notify" style="margin-top:8px;color:green"></div>
            <div id="tickets-container" class="tickets-container">
                <!-- Tickets will be dynamically inserted here -->
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 QueueWorks</p>
    </footer>
    <script>
        const storageKey = 'queueworks_tickets';
        const ticketsContainer = document.getElementById('tickets-container');
        const notifyEl = document.getElementById('notify');

        function loadTickets() {
            try { return JSON.parse(localStorage.getItem(storageKey) || '[]'); }
            catch (e) { return []; }
        }

        function renderTickets(tickets) {
            ticketsContainer.innerHTML = '';
            if (!tickets || tickets.length === 0) {
                ticketsContainer.innerHTML = '<p>No tickets yet.</p>';
                return;
            }
            for (const t of tickets) {
                const el = document.createElement('div');
                el.className = 'ticket';
                el.dataset.lehrjahr = t.lehrjahr;
                el.innerHTML = `<h3>${t.category} - ${t.name}</h3><p>${t.desc || t.description}</p><p><small>Lehrjahr: ${t.lehrjahr}</small></p>`;
                ticketsContainer.appendChild(el);
            }
        }

        function applyFilter() {
            const select = document.getElementById('lehrjahr');
            const value = select.value;
            const tickets = ticketsContainer.querySelectorAll('.ticket');
            tickets.forEach(t => {
                if (!value) { t.style.display = ''; return; }
                t.style.display = (t.dataset.lehrjahr === value) ? '' : 'none';
            });
        }

        document.getElementById('apply-filter').addEventListener('click', applyFilter);

        document.addEventListener('DOMContentLoaded', () => renderTickets(loadTickets()));

        window.addEventListener('storage', (e) => {
            if (e.key === storageKey) {
                renderTickets(loadTickets());
                notifyEl.textContent = 'New ticket submitted';
                setTimeout(() => { notifyEl.textContent = ''; }, 3000);
            }
        });
    </script>
</body>
</html>