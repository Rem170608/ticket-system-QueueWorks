<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket System - QueueWorks</title>
    <link rel="icon" type="image/x-icon" href="/Media/head.svg">
    <link rel="stylesheet" href="style.css">
    <link rel="javascript" href="/Backend/main.js">
</head>
    <main>
        <div class="container">
            <div class="card">
                <div class="navbar">
                    <div class="navbar-buttons">
                        <a href="index.html" class="nav-link">Home</a>
                        <a href="live.html" class="nav-link">Live</a>
                        <a href="login.html" class="nav-link">Login</a>
                    </div>
                </div>
            <img src="/Media/logo.svg" alt="logo" class="logo">
            <h1>Admin Dashboard</h1>
            <select name="lehrjahr" id="lehrjahr" class="input-field">
                <option value="" disabled selected>Lehrjahr</option>
                <option value="Basis">Basis</option>
                <option value="Praxis">Praxis</option>

            </select>
            <button id="delete-all" class="deletebuttons">Delete all tickets</button>
            <button id="delete-one" class="deletebuttons">Delete selected ticket</button>

            <div id="tickets-container" class="tickets-container">
                <button id="tickets-container" class="ticketsstyle"></button>
                <!-- Tickets will be dynamically inserted here -->
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 QueueWorks</p>
    </footer>
    <script>
        const storageKey = 'queueworks_tickets';
        const ticketsContainer = document.getElementById('tickets-container');

        function loadTickets() {
            try { return JSON.parse(localStorage.getItem(storageKey) || '[]'); }
            catch (e) { return []; }
        }

        function renderTickets() {
            const tickets = loadTickets();
            ticketsContainer.innerHTML = '';
            if (tickets.length === 0) { ticketsContainer.innerHTML = '<p>No tickets.</p>'; return; }
            for (const t of tickets) {
                const el = document.createElement('div');
                el.className = 'ticket';
                el.innerHTML = `<h3>${t.category} - ${t.name}</h3><p>${t.desc}</p><p><small>Lehrjahr: ${t.lehrjahr}</small></p>`;
                ticketsContainer.appendChild(el);
            }
        }

        document.getElementById('delete-all').addEventListener('click', () => {
            if (!confirm('Delete ALL tickets? This cannot be undone.')) return;
            localStorage.removeItem(storageKey);
            // trigger storage event for other tabs by writing then removing a sentinel
            try { localStorage.setItem('queueworks_tickets_cleared_at', Date.now().toString()); localStorage.removeItem('queueworks_tickets_cleared_at'); } catch(e){}
            renderTickets();
            alert('All tickets deleted');
        });
        document.getElementById('delete-one').addEventListener('click', () => {
            if (!confirm('Delete selected ticket? This cannot be undone.')) return;
            const tickets = loadTickets();
            const selectedTicket = tickets.find(t => t.selected);
            if (selectedTicket) {
                const updatedTickets = tickets.filter(t => t !== selectedTicket);
                localStorage.setItem(storageKey, JSON.stringify(updatedTickets));
                renderTickets();
                alert('Selected ticket deleted');
            } else {
                alert('No ticket selected');
            }
        });
            alert('All tickets deleted');

        document.addEventListener('DOMContentLoaded', renderTickets);
    </script>
</body>
</html>